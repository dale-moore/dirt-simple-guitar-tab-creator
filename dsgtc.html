<!DOCTYPE html>
<html lang="en">
<head>

<!--
TODO - add description
TODO - add author
TODO - add license
TODO - add dev notes.

This code follows the Google JavaScript Style Guide.
https://google.github.io/styleguide/javascriptguide.xml
 -->

<script language="javascript">
	// Each array is associated with a guitar string.
	// The array elements reflect the note being played
	// so that the first note in the tab is referneced
	// by looking at the 0 index of each array.  
	// The allowable array values are 0-6, x, X and - where
	// the - character means the string is not played in that note.
	// The x's represent muted strings.
	var gbl_x_array = [];
	var gbl_b_array = [];
	var gbl_g_array = [];
	var gbl_d_array = [];
	var gbl_a_array = [];
	var gbl_e_array = [];
	
	// TODO - we need to include note types to distinguish
	// whole notes, quarter, either and 16th notes to
	// improve the readability.
	
	// TODO - we need to include an import mechanism based on
	// a standard ASDII tab format so that songs can be reimported
	// and modified easily.  https://en.wikipedia.org/wiki/Tablature
	
	
	// This is the note that is being modified.  Of course we start on the first note.
	var gbl_note_index = 0;
	// We only support 20 notes on the staff.
	var gbl_max_notes = 20;
	// We want 2 spaces on either side of the note.
	var gbl_spaces_between_notes = 2;	// --*--
	
	
	function addNotesToFret() {	
		console.log("addNotesToFret called")
		var x_note_value = getNoteValue("x_note")
		var b_note_value = getNoteValue("b_note")
		var g_note_value = getNoteValue("g_note")
		var d_note_value = getNoteValue("d_note")
		var a_note_value = getNoteValue("a_note")
		var e_note_value = getNoteValue("e_note")
		console.log("guitar string values = high-e(" + x_note_value + "), b(" + b_note_value +
			") g(" + g_note_value + ") d(" + d_note_value +
			") a(" + a_note_value + ") low-e(" + e_note_value + ")");					
		
		gbl_x_array[gbl_note_index] = x_note_value;
		gbl_b_array[gbl_note_index] = b_note_value;
		gbl_g_array[gbl_note_index] = g_note_value;
		gbl_d_array[gbl_note_index] = d_note_value;
		gbl_a_array[gbl_note_index] = a_note_value;
		gbl_e_array[gbl_note_index] = e_note_value;
						
		displayFretBoard();
	}
	
	
	function displayFretBoard() {
		displayFretBoardString("x_string", gbl_x_array);
		displayFretBoardString("b_string", gbl_b_array);
		displayFretBoardString("g_string", gbl_g_array);
		displayFretBoardString("d_string", gbl_d_array);
		displayFretBoardString("a_string", gbl_a_array);
		displayFretBoardString("e_string", gbl_e_array);
						
		updateRemainingStatus();
	}
	
	
	function displayFretBoardString(element_name, array) {
		var display_element = document.getElementById(element_name)
		display_element.innerHTML = "";
		var output = "";
		for (i=0; i<20; i++) {
			var note_value = array[i].trim();
			if (note_value == " ") {
				note_value = "-";
			}
			output += getSpacesBetweenNote() + note_value;
		}
		display_element.innerHTML = output;
	}
	
	
	function getNoteValue(elementName) {
		console.log("getNoteValue() called for element(" + elementName + ")")
		var element = document.getElementById(elementName)
		var value = element.value		
		if (value == null) {
			return "-"
		}
		return value
	}
	
	
	function getSpacesBetweenNote() {
		var spaces = "";
		for (var counter=0; counter<gbl_spaces_between_notes; counter++) {
			spaces += "-"
		}
		return spaces;
	}
	
	
	function initializeNotes() {
				
		// We allow up to 20 notes to be added so we'll initializeNotes
		// all notes on all strings with null.
		for (var x=0; x<20; x++) {
			gbl_x_array.push(" ")
			gbl_b_array.push(" ")
			gbl_g_array.push(" ")
			gbl_d_array.push(" ")
			gbl_a_array.push(" ")
			gbl_e_array.push(" ")
		}
		
		displayFretBoard();	
		updateNoteMarker();
	}
	
	/**
	 * This function is called when the user enters a character into the
	 * edit boxes for each string to verify only
	 * 0 through 6 are supported.
	 */
	function isGuitarString(evt, control) {
		console.log("isGuitarString called with input(" + evt.keyCode + ")");
		var charCode = (evt.which) ? evt.which : evt.keyCode;

		// Verify the number is in the ASCII range of
		// 48 which is decimal 0 and 54 which is decimal 6.
        if (charCode < 48 || charCode > 54) {
            // the character 'x' is also supported.  88 is uppercase X,
			// 120 is lower case x and also 8 which is a backspace.
			if (charCode != 88 && charCode != 120 && charCode != 8) {
			    console.log("not a guitar string")
                control.value = "";
				return false;
			}
        }    
		addNotesToFret();
        return true;
	}
	
	
	function loadNotesFromArray() {
		console.log("loadNotesFromArray() called")
		var x_note_value = gbl_x_array[gbl_note_index];
		var b_note_value = gbl_b_array[gbl_note_index];
		var g_note_value = gbl_g_array[gbl_note_index];
		var d_note_value = gbl_d_array[gbl_note_index];
		var a_note_value = gbl_a_array[gbl_note_index];
		var e_note_value = gbl_e_array[gbl_note_index];
				
		console.log("guitar string values = high-e(" + x_note_value + "), b(" + b_note_value +
			") g(" + g_note_value + ") d(" + d_note_value +
			") a(" + a_note_value + ") low-e(" + e_note_value + ")");					
			
		setNoteValue("x_note", x_note_value);
		setNoteValue("b_note", b_note_value);
		setNoteValue("g_note", g_note_value);
		setNoteValue("d_note", d_note_value);
		setNoteValue("a_note", a_note_value);
		setNoteValue("e_note", e_note_value);						
	}
	
	
	function onNext() {
		gbl_note_index++;
		if (gbl_note_index > (gbl_max_notes-1)) {
			gbl_note_index = 0;
		}	
		loadNotesFromArray();
		updateNoteMarker();
		updateRemainingStatus();
	}
	
	
	function onPrevious() {
		gbl_note_index--;
		if (gbl_note_index < 0) {
			gbl_note_index = (gbl_max_notes - 1)
		}
		loadNotesFromArray();
		updateNoteMarker();
		updateRemainingStatus();
	}
	
	
	
	
	function setNoteValue(elementName, value) {
		console.log("setNoteValue() called for element(" + elementName + ") and value(" + value + ")")
		var element = document.getElementById(elementName)
		element.value = value;		
	}
	
	/*	
	function setNote(element) {			
		var state = false;
		if (element.getAttribute("on")=="true") {
			element.innerHTML = "---"
			state = "false";
		}
		else {
			element.innerHTML = "-*-"
			state = "true";
		}				
		element.setAttribute("on", state);
	}
	*/
	
	
	/**
	 * This function is called when the note index is changed.
	 * The function places an icon above the notes that are being changed
	 * on the fret board.
	 */
	function updateNoteMarker() {
		var display_element = document.getElementById("note_marker")
		display_element.innerHTML = "";
		var output = "--";
		for (var i=0; i<gbl_note_index; i++) {			
			output += getSpacesBetweenNote();
		}
		// place the marker
		output += "<img src=\"./images/dot.png\"/>";
		display_element.innerHTML = output;
	}
		
	/**
     * the remaining status is a field along the bottom of the 
     * page that shows the user where the current index is into the
     * staff of notes
     */	 
	function updateRemainingStatus() {
		//var remaining = gbl_max_notes - gbl_note_index;
		//var element = document.getElementById("remaining_status")
		//element.innerHTML = remaining + " out of " + gbl_max_notes + " notes remaining"
		//element.innerHTML = ""
	}
</script>

<style type="text/css">
.guitar-string {
	font-size: 14px;
	cursor: crosshair;
	display:  inline;
}
.guitar-note {
	font-size: 14px;
	display:  inline;
    text-align: center;
}
.guitar-string-no-edit {
	font-size: 14px;	
	display:  inline;
}
.add-button {
	vertical-align: bottom;
}
.status {
	.display: block;
}
.nav-button {
	cursor: pointer;
}
</style>

</head>
<body onload="initializeNotes()">

<h1>Dirt Simple Guitar Tab Creator</h1>

<hr/>
Select each string for the note or select a chord to add. 
<div>

<div style="display:table; border-right: 20px">
	<div style="display:table-row">
		<div style="display:table-cell">
			<img class="nav-button" src="./images/previous.png" onclick="onPrevious();"/>
		</div>
		<div style="display:table-cell">
<pre>
e | -- <input id="x_note" name="x_note" type="text" size="1" class="guitar-note" onkeyup="return isGuitarString(event,this)"/> --
B | -- <input id="b_note" name="b_note" type="text" size="1" class="guitar-note" onkeyup="return isGuitarString(event,this)"/> --
G | -- <input id="g_note" name="g_note" type="text" size="1" class="guitar-note" onkeyup="return isGuitarString(event,this)"/> --
D | -- <input id="d_note" name="d_note" type="text" size="1" class="guitar-note" onkeyup="return isGuitarString(event,this)"/> --
A | -- <input id="a_note" name="a_note" type="text" size="1" class="guitar-note" onkeyup="return isGuitarString(event,this)"/> --
E | -- <input id="e_note" name="e_note" type="text" size="1" class="guitar-note" onkeyup="return isGuitarString(event,this)"/> --
</pre>
		</div>
		<div style="display:table-cell">
		<img class="nav-button" src="./images/next.png" onclick="onNext();"/>
		</div>
	</div>
</div>

<hr/>

<hr/>
The following is the generated ASCII tab that you can select and copy to the clipboard for
inclusion in your text document.
<pre>
   <div id="note_marker" class="guitar-string-no-edit"></div>
   <div id="chord_name" class="guitar-string-no-edit"></div>

e |<div id="x_string" class="guitar-string-no-edit"></div>
B |<div id="b_string" class="guitar-string-no-edit"></div>
G |<div id="g_string" class="guitar-string-no-edit"></div>
D |<div id="d_string" class="guitar-string-no-edit"></div>
A |<div id="a_string" class="guitar-string-no-edit"></div>
E |<div id="e_string" class="guitar-string-no-edit"></div>
</pre>
<br/>
<hr/>
<div id="remaining_status" class="status"/>
<h2>Instructions</h2>
This page provides a simple way to create guitar tabs that can be copied from the web page
into your text documents.  
<p>
The guitar strings are labeled on the left with the lowercase e for the high E string.  Tab lines
are numberd 1 through 6 which is the standard string numbering where "1" is the high E string and 
2 is the B" string, etc...
<p>
The following is an example of an E, F and G chord in ASCII tab.
<pre>
      E  F  G
e | --0--1--3--
B | --0--1--0--
G | --1--2--0--
D | --2--3--0--
A | --2--3--2--
E | --0--1--3--
</pre>
The letters above the staff represent the chord name.  This program will automatically add the
chord name if a common chord is detected.
<p>
After creating your tab, simply select the generated ASCII tab and copy/paste into your ASCII text document.
</body>
</html>

<!--
NOTES:
- consider using bootstrap for styling.
- here's a good reference page for CCS properties:
  http://www.pageresource.com/dhtml/cssprops.htm#classification_properties

-->
